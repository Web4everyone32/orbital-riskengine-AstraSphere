<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AstraSphere – Orbital Intelligence</title>

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Widgets/widgets.css" rel="stylesheet"/>

  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
    }

    .overlay {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-family: Arial, sans-serif;
      z-index: 10;
      max-width: 320px;
    }

    .overlay h1 {
      margin: 0;
      font-size: 22px;
      color: #00e5ff;
    }

    .overlay p {
      font-size: 13px;
      opacity: 0.85;
    }
  </style>
</head>

<body>
<div id="cesiumContainer"></div>

<div class="overlay">
  <h1>AstraSphere</h1>
  <p>Orbital Intelligence Platform</p>
  <p><b>Click a satellite</b> to view orbital details.</p>
</div>

<script>
  // =========================
  // CESIUM VIEWER (EARTH MODE)
  // =========================

  const viewer = new Cesium.Viewer("cesiumContainer", {
    animation: true,
    timeline: true,
    shouldAnimate: true,
    baseLayerPicker: false,
    geocoder: false,
    homeButton: true,
    sceneModePicker: false,
    navigationHelpButton: false,
    imageryProvider: new Cesium.IonImageryProvider({ assetId: 2 }) // EARTH
  });

  // === Force Earth Visibility ===
  viewer.scene.globe.show = true;
  viewer.scene.globe.enableLighting = true;
  viewer.scene.skyAtmosphere.show = true;

  // === Camera MUST be Earth-centered ===
  viewer.camera.flyTo({
    destination: Cesium.Cartesian3.fromDegrees(
      0,    // longitude
      20,   // latitude
      15_000_000 // altitude (15,000 km)
    )
  });

  // === Time ===
  viewer.clock.multiplier = 60;
  viewer.clock.shouldAnimate = true;

  // =========================
  // SAMPLE SATELLITES
  // =========================

  const satellites = [
    {
      name: "GRACE-FO",
      altitude: 490000,
      inclination: 89,
      periodMinutes: 95,
      color: Cesium.Color.CYAN,
      launched: "2018-05-22"
    },
    {
      name: "LANDSAT-8",
      altitude: 705000,
      inclination: 98.2,
      periodMinutes: 99,
      color: Cesium.Color.LIME,
      launched: "2013-02-11"
    }
  ];

  function addOrbit(sat) {
    const positions = [];
    for (let i = 0; i <= 360; i++) {
      const lon = i;
      const lat = Math.sin(Cesium.Math.toRadians(i)) * sat.inclination;
      positions.push(
        Cesium.Cartesian3.fromDegrees(lon, lat, sat.altitude)
      );
    }

    viewer.entities.add({
      polyline: {
        positions: positions,
        width: 2,
        material: sat.color.withAlpha(0.6)
      }
    });
  }

  function addSatellite(sat) {
    const start = Cesium.JulianDate.now();
    const position = new Cesium.SampledPositionProperty();

    for (let i = 0; i <= 360; i += 5) {
      const time = Cesium.JulianDate.addSeconds(
        start,
        (sat.periodMinutes * 60 / 360) * i,
        new Cesium.JulianDate()
      );

      const lon = i;
      const lat = Math.sin(Cesium.Math.toRadians(i)) * sat.inclination;

      position.addSample(
        time,
        Cesium.Cartesian3.fromDegrees(lon, lat, sat.altitude)
      );
    }

    viewer.entities.add({
      name: sat.name,
      position: position,
      point: {
        pixelSize: 9,
        color: sat.color
      },
      label: {
        text: sat.name,
        font: "12px sans-serif",
        pixelOffset: new Cesium.Cartesian2(10, -10),
        showBackground: true,
        backgroundColor: Cesium.Color.BLACK.withAlpha(0.6)
      },
      description: `
        <b>${sat.name}</b><br/>
        Altitude: ${(sat.altitude/1000).toFixed(0)} km<br/>
        Inclination: ${sat.inclination}°<br/>
        Period: ${sat.periodMinutes} min<br/>
        Launched: ${sat.launched}
      `
    });
  }

  satellites.forEach(sat => {
    addOrbit(sat);
    addSatellite(sat);
  });
</script>

</body>
</html>
